
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../404/">
      
      
        <link rel="next" href="../406/">
      
      
      <link rel="icon" href="../../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>4.5. Middleware personalizado - Desarrollo Web en Entorno Servidor (DWES)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#45-middleware-personalizado" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-header__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Desarrollo Web en Entorno Servidor (DWES)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4.5. Middleware personalizado
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="amber" data-md-color-accent="amber"  aria-label="Cambia a modo oscuro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambia a modo oscuro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="amber"  aria-label="Cambia a modo normal"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambia a modo normal" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m3.55 19.09 1.41 1.41 1.8-1.79-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71 1.8 1.79 1.41-1.41-1.79-1.8M20.45 5l-1.41-1.4-1.8 1.79 1.42 1.42M13 1h-2v3h2M6.76 5.39 4.96 3.6 3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="B煤squeda" placeholder="B煤squeda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando b煤squeda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navegaci贸n" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Desarrollo Web en Entorno Servidor (DWES)" class="md-nav__button md-logo" aria-label="Desarrollo Web en Entorno Servidor (DWES)" data-md-component="logo">
      
  <img src="../../img/logo.png" alt="logo">

    </a>
    Desarrollo Web en Entorno Servidor (DWES)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contenidos
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
     PHP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
             PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UT 1 Arquitectura Web
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            UT 1 Arquitectura Web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0101/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0102/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2. Arquitecturas web
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0103/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.3. Generar p谩ginas web
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0104/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.4. Modelos de programaci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0105/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.5. Decisiones de dise帽o
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0106/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.6. Ejecuci贸n del c贸digo
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0107/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.7. Herramientas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0108/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.8. Tecnolog铆as
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0109/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.9. Navegadores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut0110/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.10. Puesta en marcha
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut01de/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Descargas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut01/ut01ac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ejercicios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UT 2 Lenguaje PHP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            UT 2 Lenguaje PHP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2. PHP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.3. Operadores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.4. Arrays
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.5. Funciones
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.6. Funciones predefinidas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut0207/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.7. Expresiones regulares
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut02/ut02ac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ejercicios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UT 3 PHP OO
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            UT 3 PHP OO
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0301/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0302/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2. Clases y objetos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0303/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3. Encapsulaci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0304/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.4. Constructor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0305/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5. Clases est谩ticas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0306/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.6. Introspecci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0307/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.7. Herencia
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0308/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.8. Clases abstractas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0309/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.9. Clases final
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0310/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.10. Interfaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0311/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.11. M茅todos encadenados
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0312/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.12. M茅todos m谩gicos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0313/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.13. Espacio de nombres
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0314/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.14. Gesti贸n de errores
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0315/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.15. Excepciones
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut0316/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.16. SPL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut03/ut03ac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ejercicios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UT 4 Programaci贸n web
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            UT 4 Programaci贸n web
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0401/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0402/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2. Variable de servidor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0403/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3. Formularios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0404/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4.Cabeceras de respuesta
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0405/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.5. Gesti贸n de estado
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut0406/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.6. Autenticaci贸n de usuarios
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut04/ut04ac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Ejercicios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UT 5 Acceso a Base de Datos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            UT 5 Acceso a Base de Datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0501/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.1. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0502/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.2. Instalaci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0503/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.3. Estructura de BD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0504/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.4. SQL
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0505/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.5. phpMyAdmin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0506/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.6. MySQLi
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0507/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.7. Php Data Object
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0508/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.8. Login & Password
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut0509/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5.9. Acceso a ficheros
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ut05/ut05ac/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ejercicios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
     Laravel
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
             Laravel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UPL 1 ED profesional
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            UPL 1 ED profesional
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/100/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.0. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/101/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.1. Introducci贸n a Laravel12
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/102/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.2. 驴C贸mo Habla una Aplicaci贸n Laravel?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/103/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.3. 驴D贸nde Vive y Corre Nuestra Aplicaci贸n?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/104/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.4. Herramientas Esenciales para el Desarrollador
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/105/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.5. El Frontend Moderno: Vite y Tailwind CSS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/106/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1.6. Anatom铆a de una Aplicaci贸n Laravel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl1/10p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pr谩ctica guiada
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UPL 2 Fundamentos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            UPL 2 Fundamentos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/200/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.0. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/201/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.1 Viaje Interno de una Petici贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/202/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.2. Mapa de la aplicaci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/203/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.3. Vistas din谩micas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/204/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.4. Layouts y herencia en Blade
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/205/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.5. Del controlador a la vista
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/206/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2.6. Datos mock
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl2/20p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pr谩ctica guiada
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UPL 3 Gesti贸n de datos
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            UPL 3 Gesti贸n de datos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/300/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.0. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/301/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.1. Migraciones y Estructura
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/302/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.2. Eloquent ORM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/303/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.3. CRUD con Eloquent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/304/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.4. Relaciones Eloquent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/305/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3.5. Seeders y Factories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../upl3/30p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pr谩ctica guiada
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    UPL 4 Interacci贸n con el usuario
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            UPL 4 Interacci贸n con el usuario
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../400/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.0. Introducci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../401/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.1. Formularios seguros
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../402/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.2. Sistema de validaci贸n
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../403/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.3. Manejo de sesiones y estado
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../404/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.4. Autenticaci贸n b谩sica
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    4.5. Middleware personalizado
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    4.5. Middleware personalizado
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-fundamentos-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1. Fundamentos del middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Fundamentos del middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-que-es-el-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. 驴Qu茅 es el middleware?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-flujo-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Flujo del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-tipos-de-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Tipos de middleware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-crear-middleware-personalizado" class="md-nav__link">
    <span class="md-ellipsis">
      2. Crear middleware personalizado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Crear middleware personalizado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-generar-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Generar middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-estructura-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Estructura del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-middleware-con-parametros" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. Middleware con par谩metros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-registrar-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      3. Registrar middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Registrar middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-registro-en-bootstrapappphp" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. Registro en bootstrap/app.php
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-aplicar-middleware-a-rutas" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Aplicar middleware a rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-casos-de-uso-comunes" class="md-nav__link">
    <span class="md-ellipsis">
      4. Casos de uso comunes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Casos de uso comunes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-rate-limiting-personalizado" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Rate Limiting personalizado
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-middleware-de-validacion-de-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Middleware de validaci贸n de API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-middleware-de-transformacion-de-respuesta" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Middleware de transformaci贸n de respuesta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-middleware-avanzado" class="md-nav__link">
    <span class="md-ellipsis">
      5. Middleware avanzado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Middleware avanzado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-middleware-de-cache" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Middleware de cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-middleware-de-logging-de-errores" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Middleware de Logging de errores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-middleware-de-normalizacion-de-entrada" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Middleware de normalizaci贸n de entrada
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-testing-de-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      6. Testing de middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Testing de middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-test-basico" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. Test b谩sico
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-test-de-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. Test de Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-mejores-practicas" class="md-nav__link">
    <span class="md-ellipsis">
      7. Mejores pr谩cticas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Mejores pr谩cticas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-organizacion-del-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      7.1. Organizaci贸n del c贸digo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-documentacion-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      7.2. Documentaci贸n del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-configuracion-flexible" class="md-nav__link">
    <span class="md-ellipsis">
      7.3. Configuraci贸n flexible
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../406/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.6. Blade Components para Layouts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../407/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4.7. Sistema de almacenamiento de archivos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../40p/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pr谩ctica guiada
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Pruebas
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Pruebas
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru02/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2. Controladores y Rutas
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru03/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    3. Desarrollo de un CRUD
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru04/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    4. Validaciones, Rutas Resource y Mensajes del Sistema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru05/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. Creaci贸n de APIs REST
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru06/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    6. Autenticaci贸n B谩sica
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru07/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    7. Sistema de almacenamiento de archivos
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_7" >
        
          
          <label class="md-nav__link" for="__nav_4_5_7" id="__nav_4_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Despliegue
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_7">
            <span class="md-nav__icon md-icon"></span>
            Despliegue
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru08a/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introducci贸n al despliegue de aplicaciones web
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru08b/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aplicaci贸n simple con estructura precaria php
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru08c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aplicaci贸n completa con estructura de laravel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/pru08d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Despliegue en PaaS Render
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pru/examen2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examen 2 Laravel
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-fundamentos-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1. Fundamentos del middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Fundamentos del middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-que-es-el-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.1. 驴Qu茅 es el middleware?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-flujo-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.2. Flujo del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-tipos-de-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      1.3. Tipos de middleware
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-crear-middleware-personalizado" class="md-nav__link">
    <span class="md-ellipsis">
      2. Crear middleware personalizado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Crear middleware personalizado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-generar-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      2.1. Generar middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-estructura-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      2.2. Estructura del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-middleware-con-parametros" class="md-nav__link">
    <span class="md-ellipsis">
      2.3. Middleware con par谩metros
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-registrar-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      3. Registrar middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Registrar middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-registro-en-bootstrapappphp" class="md-nav__link">
    <span class="md-ellipsis">
      3.1. Registro en bootstrap/app.php
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-aplicar-middleware-a-rutas" class="md-nav__link">
    <span class="md-ellipsis">
      3.2. Aplicar middleware a rutas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-casos-de-uso-comunes" class="md-nav__link">
    <span class="md-ellipsis">
      4. Casos de uso comunes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Casos de uso comunes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-rate-limiting-personalizado" class="md-nav__link">
    <span class="md-ellipsis">
      4.1. Rate Limiting personalizado
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-middleware-de-validacion-de-api" class="md-nav__link">
    <span class="md-ellipsis">
      4.2. Middleware de validaci贸n de API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-middleware-de-transformacion-de-respuesta" class="md-nav__link">
    <span class="md-ellipsis">
      4.3. Middleware de transformaci贸n de respuesta
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-middleware-avanzado" class="md-nav__link">
    <span class="md-ellipsis">
      5. Middleware avanzado
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Middleware avanzado">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-middleware-de-cache" class="md-nav__link">
    <span class="md-ellipsis">
      5.1. Middleware de cache
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-middleware-de-logging-de-errores" class="md-nav__link">
    <span class="md-ellipsis">
      5.2. Middleware de Logging de errores
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-middleware-de-normalizacion-de-entrada" class="md-nav__link">
    <span class="md-ellipsis">
      5.3. Middleware de normalizaci贸n de entrada
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-testing-de-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      6. Testing de middleware
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6. Testing de middleware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-test-basico" class="md-nav__link">
    <span class="md-ellipsis">
      6.1. Test b谩sico
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-test-de-rate-limiting" class="md-nav__link">
    <span class="md-ellipsis">
      6.2. Test de Rate Limiting
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-mejores-practicas" class="md-nav__link">
    <span class="md-ellipsis">
      7. Mejores pr谩cticas
    </span>
  </a>
  
    <nav class="md-nav" aria-label="7. Mejores pr谩cticas">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-organizacion-del-codigo" class="md-nav__link">
    <span class="md-ellipsis">
      7.1. Organizaci贸n del c贸digo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72-documentacion-del-middleware" class="md-nav__link">
    <span class="md-ellipsis">
      7.2. Documentaci贸n del middleware
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73-configuracion-flexible" class="md-nav__link">
    <span class="md-ellipsis">
      7.3. Configuraci贸n flexible
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="45-middleware-personalizado">4.5. Middleware personalizado<a class="headerlink" href="#45-middleware-personalizado" title="Permanent link">&para;</a></h1>
<p>En el <strong>apartado 4</strong> aprendiste c贸mo autenticar usuarios con Laravel Breeze. Pero 驴qu茅 pasa si necesitas aplicar <strong>l贸gica com煤n</strong> a m煤ltiples rutas antes de que lleguen al controlador?</p>
<p>El middleware personalizado permite aplicar l贸gica com煤n a m煤ltiples rutas, manteniendo el c贸digo organizado y reutilizable. Laravel proporciona un sistema de middleware flexible que permite crear, registrar y aplicar middleware personalizado para diferentes prop贸sitos como logging, <em>rate limiting</em>, validaciones espec铆ficas y transformaci贸n de respuestas.</p>
<h2 id="1-fundamentos-del-middleware">1. Fundamentos del middleware<a class="headerlink" href="#1-fundamentos-del-middleware" title="Permanent link">&para;</a></h2>
<h3 id="11-que-es-el-middleware">1.1. 驴Qu茅 es el middleware?<a class="headerlink" href="#11-que-es-el-middleware" title="Permanent link">&para;</a></h3>
<p>El middleware es una capa de software que procesa las peticiones HTTP <strong>antes</strong> de que lleguen a los controladores y <strong>despu茅s</strong> de que se genere la respuesta. Act煤a como un filtro que puede modificar, validar o interceptar las peticiones y respuestas.</p>
<h3 id="12-flujo-del-middleware">1.2. Flujo del middleware<a class="headerlink" href="#12-flujo-del-middleware" title="Permanent link">&para;</a></h3>
<p>El middleware opera en capas: la petici贸n atraviesa cada middleware hasta llegar al controlador y luego la respuesta atraviesa los mismos middleware en orden inverso. Este flujo bidireccional permite procesar tanto las peticiones entrantes como las respuestas salientes.</p>
<div class="mermaid">graph TD
    A[Petici贸n HTTP] --&gt; B[Middleware 1]
    B --&gt; C[Middleware 2]
    C --&gt; D[Middleware 3]
    D --&gt; E[Controlador]
    E --&gt; F[Respuesta]
    F --&gt; G[Middleware 3]
    G --&gt; H[Middleware 2]
    H --&gt; I[Middleware 1]
    I --&gt; J[Respuesta Final]</div>
<h3 id="13-tipos-de-middleware">1.3. Tipos de middleware<a class="headerlink" href="#13-tipos-de-middleware" title="Permanent link">&para;</a></h3>
<p>Laravel organiza el middleware en diferentes categor铆as seg煤n su alcance y aplicaci贸n. Conocer estos tipos te ayuda a decidir d贸nde y c贸mo registrar tu middleware personalizado.</p>
<table>
<thead>
<tr>
<th>Tipo</th>
<th>Descripci贸n</th>
<th>Ejemplo</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Global</strong></td>
<td>Se aplica a todas las peticiones</td>
<td>CORS, Logging</td>
</tr>
<tr>
<td><strong>Grupo</strong></td>
<td>Se aplica a grupos de rutas</td>
<td>Web, API</td>
</tr>
<tr>
<td><strong>Ruta</strong></td>
<td>Se aplica a rutas espec铆ficas</td>
<td>Auth, Rate Limiting</td>
</tr>
<tr>
<td><strong>Personalizado</strong></td>
<td>L贸gica espec铆fica de la aplicaci贸n</td>
<td>Validaci贸n, Transformaci贸n</td>
</tr>
</tbody>
</table>
<h2 id="2-crear-middleware-personalizado">2. Crear middleware personalizado<a class="headerlink" href="#2-crear-middleware-personalizado" title="Permanent link">&para;</a></h2>
<p>Laravel facilita la creaci贸n de middleware personalizado mediante Artisan. Puedes crear middleware para cualquier l贸gica espec铆fica de tu aplicaci贸n: logging, validaci贸n, transformaci贸n de datos, control de acceso y m谩s.</p>
<h3 id="21-generar-middleware">2.1. Generar middleware<a class="headerlink" href="#21-generar-middleware" title="Permanent link">&para;</a></h3>
<p>El primer paso para crear middleware personalizado es generarlo usando Artisan. Esto crear谩 una clase base con la estructura necesaria que podr谩s personalizar seg煤n tus necesidades.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Crear middleware personalizado</span>
php<span class="w"> </span>artisan<span class="w"> </span>make:middleware<span class="w"> </span>LogUserActivity
</code></pre></div>
<h3 id="22-estructura-del-middleware">2.2. Estructura del middleware<a class="headerlink" href="#22-estructura-del-middleware" title="Permanent link">&para;</a></h3>
<p>Un middleware t铆pico tiene un m茅todo <code>handle()</code> que recibe la petici贸n y una funci贸n <code>$next()</code>. Puedes ejecutar l贸gica antes de llamar a <code>$next()</code> (antes del controlador) y despu茅s (despu茅s del controlador).</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogUserActivity</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// L贸gica antes de procesar la petici贸n</span>
        <span class="nv">$startTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

        <span class="c1">// Procesar la petici贸n</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// L贸gica despu茅s de procesar la petici贸n</span>
        <span class="nv">$endTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="nv">$duration</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="nv">$endTime</span> <span class="o">-</span> <span class="nv">$startTime</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

        <span class="c1">// Log de la actividad</span>
        <span class="nx">Log</span><span class="o">::</span><span class="na">info</span><span class="p">(</span><span class="s1">&#39;User activity&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">(),</span>
            <span class="s1">&#39;user_name&#39;</span> <span class="o">=&gt;</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">?-&gt;</span><span class="na">name</span><span class="p">,</span>
            <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(),</span>
            <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
            <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">(),</span>
            <span class="s1">&#39;user_agent&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">userAgent</span><span class="p">(),</span>
            <span class="s1">&#39;duration_ms&#39;</span> <span class="o">=&gt;</span> <span class="nv">$duration</span><span class="p">,</span>
            <span class="s1">&#39;status_code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span>
            <span class="s1">&#39;timestamp&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
        <span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="23-middleware-con-parametros">2.3. Middleware con par谩metros<a class="headerlink" href="#23-middleware-con-parametros" title="Permanent link">&para;</a></h3>
<p>Los middleware pueden aceptar par谩metros adicionales para hacerlos m谩s flexibles y reutilizables. Esto te permite crear un solo middleware que se comporta diferente seg煤n los par谩metros que reciba.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckUserRole</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$role</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">check</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasRole</span><span class="p">(</span><span class="nv">$role</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s1">&#39;No tienes permisos para acceder a esta p谩gina&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="3-registrar-middleware">3. Registrar middleware<a class="headerlink" href="#3-registrar-middleware" title="Permanent link">&para;</a></h2>
<p>Despu茅s de crear el middleware, necesitas registrarlo para que Laravel sepa cu谩ndo y c贸mo aplicarlo. El registro determina si el middleware es global, de grupo o de ruta.</p>
<h3 id="31-registro-en-bootstrapappphp">3.1. Registro en bootstrap/app.php<a class="headerlink" href="#31-registro-en-bootstrapappphp" title="Permanent link">&para;</a></h3>
<p>Una vez creado el middleware, debes registrarlo en tu aplicaci贸n para que Laravel lo reconozca y pueda aplicarlo. El registro se realiza en el archivo <code>bootstrap/app.php</code> y determina su alcance (global, grupo o ruta espec铆fica).</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap/app.php</span>
<span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Middleware global</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">web</span><span class="p">(</span><span class="nx">append</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">\App\Http\Middleware\LogUserActivity</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// Middleware de grupo</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="nx">\App\Http\Middleware\CheckUserRole</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="c1">// Alias de middleware</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">([</span>
        <span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\CheckUserRole</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;log.activity&#39;</span> <span class="o">=&gt;</span> <span class="nx">\App\Http\Middleware\LogUserActivity</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">})</span>
</code></pre></div>
<h3 id="32-aplicar-middleware-a-rutas">3.2. Aplicar middleware a rutas<a class="headerlink" href="#32-aplicar-middleware-a-rutas" title="Permanent link">&para;</a></h3>
<p>Una vez registrado con un alias, puedes aplicar el middleware a rutas individuales o grupos de rutas usando el m茅todo <code>middleware()</code>. Tambi茅n puedes combinar m煤ltiples middleware.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Aplicar middleware a rutas espec铆ficas</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">AdminController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;role:admin&#39;</span><span class="p">);</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ProductController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">([</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;log.activity&#39;</span><span class="p">]);</span>

<span class="c1">// Aplicar middleware a grupos de rutas</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">middleware</span><span class="p">([</span><span class="s1">&#39;auth&#39;</span><span class="p">,</span> <span class="s1">&#39;role:admin&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin/users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/admin/users&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;store&#39;</span><span class="p">]);</span>
    <span class="nx">Route</span><span class="o">::</span><span class="na">delete</span><span class="p">(</span><span class="s1">&#39;/admin/users/{user}&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">UserController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;destroy&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<h2 id="4-casos-de-uso-comunes">4. Casos de uso comunes<a class="headerlink" href="#4-casos-de-uso-comunes" title="Permanent link">&para;</a></h2>
<p>El middleware personalizado puede resolver muchos problemas comunes en aplicaciones web: </p>
<ul>
<li><em>rate limiting</em>, </li>
<li>validaci贸n de API, </li>
<li>transformaci贸n de respuestas, </li>
<li>logging </li>
<li>y m谩s... </li>
</ul>
<p>Estos ejemplos te muestran patrones 煤tiles que puedes adaptar.</p>
<h3 id="41-rate-limiting-personalizado">4.1. Rate Limiting personalizado<a class="headerlink" href="#41-rate-limiting-personalizado" title="Permanent link">&para;</a></h3>
<p>El <em>rate limiting</em> controla cu谩ntas peticiones puede hacer un usuario en un per铆odo de tiempo. Crear <em>rate limiting</em> personalizado te permite aplicar diferentes l铆mites seg煤n el tipo de usuario, la acci贸n que realiza o el recurso al que accede.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RateLimitProductCreation</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$userId</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">();</span>
        <span class="nv">$key</span> <span class="o">=</span> <span class="s1">&#39;product_creation_&#39;</span> <span class="o">.</span> <span class="nv">$userId</span><span class="p">;</span>
        <span class="nv">$attempts</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nv">$limit</span> <span class="o">=</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">is_premium</span> <span class="o">?</span> <span class="mi">20</span> <span class="o">:</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// L铆mite diferente para usuarios premium</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$attempts</span> <span class="o">&gt;=</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span>
                <span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Has alcanzado el l铆mite de productos que puedes crear por hora.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;limit&#39;</span> <span class="o">=&gt;</span> <span class="nv">$limit</span><span class="p">,</span>
                <span class="s1">&#39;reset_time&#39;</span> <span class="o">=&gt;</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;_reset&#39;</span><span class="p">)</span>
            <span class="p">],</span> <span class="mi">429</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Incrementar contador solo si la petici贸n fue exitosa</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">isMethod</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">routeIs</span><span class="p">(</span><span class="s1">&#39;products.store&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="nv">$key</span><span class="p">,</span> <span class="nv">$attempts</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3600</span><span class="p">);</span> <span class="c1">// 1 hora</span>
            <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="nv">$key</span> <span class="o">.</span> <span class="s1">&#39;_reset&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addHour</span><span class="p">(),</span> <span class="mi">3600</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="42-middleware-de-validacion-de-api">4.2. Middleware de validaci贸n de API<a class="headerlink" href="#42-middleware-de-validacion-de-api" title="Permanent link">&para;</a></h3>
<p>En APIs REST es com煤n requerir formatos espec铆ficos en las peticiones (headers, estructura JSON, autenticaci贸n por tokens). Un middleware de validaci贸n de API verifica estos requisitos antes de que la petici贸n llegue al controlador.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ValidateApiRequest</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// Verificar header de API</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">hasHeader</span><span class="p">(</span><span class="s1">&#39;X-API-Key&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;API Key requerida&#39;</span><span class="p">],</span> <span class="mi">401</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Verificar formato de API Key</span>
        <span class="nv">$apiKey</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-API-Key&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">preg_match</span><span class="p">(</span><span class="s1">&#39;/^[a-zA-Z0-9]{32}$/&#39;</span><span class="p">,</span> <span class="nv">$apiKey</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Formato de API Key inv谩lido&#39;</span><span class="p">],</span> <span class="mi">401</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Verificar que la API Key existe en la base de datos</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;api_key&#39;</span><span class="p">,</span> <span class="nv">$apiKey</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">([</span><span class="s1">&#39;error&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;API Key no v谩lida&#39;</span><span class="p">],</span> <span class="mi">401</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// A帽adir usuario a la petici贸n</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">([</span><span class="s1">&#39;authenticated_user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="43-middleware-de-transformacion-de-respuesta">4.3. Middleware de transformaci贸n de respuesta<a class="headerlink" href="#43-middleware-de-transformacion-de-respuesta" title="Permanent link">&para;</a></h3>
<p>A veces necesitas transformar todas las respuestas de ciertas rutas a un formato espec铆fico, como envolver los datos en una estructura est谩ndar de API o a帽adir metadatos adicionales. Este middleware act煤a despu茅s de que el controlador genera la respuesta.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TransformResponse</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Solo transformar respuestas JSON</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;application/json&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$content</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">(),</span> <span class="k">true</span><span class="p">);</span>

            <span class="c1">// A帽adir metadatos</span>
            <span class="nv">$transformedContent</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$content</span><span class="p">,</span>
                <span class="s1">&#39;meta&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                    <span class="s1">&#39;timestamp&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toISOString</span><span class="p">(),</span>
                    <span class="s1">&#39;version&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1.0&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;request_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">header</span><span class="p">(</span><span class="s1">&#39;X-Request-ID&#39;</span><span class="p">,</span> <span class="nb">uniqid</span><span class="p">()),</span>
                <span class="p">]</span>
            <span class="p">];</span>

            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$transformedContent</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="5-middleware-avanzado">5. Middleware avanzado<a class="headerlink" href="#5-middleware-avanzado" title="Permanent link">&para;</a></h2>
<p>Los middleware avanzados implementan patrones m谩s complejos como caching de respuestas, logging de errores con contexto detallado y sanitizaci贸n autom谩tica de inputs. Estos ejemplos muestran t茅cnicas profesionales de producci贸n.</p>
<h3 id="51-middleware-de-cache">5.1. Middleware de cache<a class="headerlink" href="#51-middleware-de-cache" title="Permanent link">&para;</a></h3>
<p>El caching de respuestas puede mejorar dr谩sticamente el rendimiento de tu aplicaci贸n al almacenar respuestas completas y servirlas directamente sin ejecutar el controlador. Este middleware verifica si existe una respuesta en cach茅 antes de procesarla.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CacheResponse</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$minutes</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// Generar clave de cache</span>
        <span class="nv">$cacheKey</span> <span class="o">=</span> <span class="s1">&#39;response_&#39;</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">()</span> <span class="o">.</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">()));</span>

        <span class="c1">// Verificar si existe en cache</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Cache</span><span class="o">::</span><span class="na">has</span><span class="p">(</span><span class="nv">$cacheKey</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$cachedResponse</span> <span class="o">=</span> <span class="nx">Cache</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$cacheKey</span><span class="p">);</span>
            <span class="k">return</span> <span class="nx">response</span><span class="p">(</span><span class="nv">$cachedResponse</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">])</span>
                <span class="o">-&gt;</span><span class="na">withHeaders</span><span class="p">(</span><span class="nv">$cachedResponse</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// Procesar petici贸n</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Cachear respuesta si es exitosa</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Cache</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="nv">$cacheKey</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;content&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getContent</span><span class="p">(),</span>
                <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">(),</span>
            <span class="p">],</span> <span class="nv">$minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="52-middleware-de-logging-de-errores">5.2. Middleware de Logging de errores<a class="headerlink" href="#52-middleware-de-logging-de-errores" title="Permanent link">&para;</a></h3>
<p>Capturar y registrar errores de forma centralizada es crucial para el mantenimiento de aplicaciones. Este middleware intercepta excepciones y las registra con contexto adicional antes de que Laravel las maneje.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Log</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">LogErrors</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>

        <span class="c1">// Log errores del servidor</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Log</span><span class="o">::</span><span class="na">error</span><span class="p">(</span><span class="s1">&#39;Server error occurred&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;status_code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span>
                <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
                <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(),</span>
                <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">(),</span>
                <span class="s1">&#39;user_agent&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">userAgent</span><span class="p">(),</span>
                <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">(),</span>
                <span class="s1">&#39;request_data&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">except</span><span class="p">([</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;password_confirmation&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;timestamp&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="c1">// Log errores del cliente</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">400</span> <span class="o">&amp;&amp;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Log</span><span class="o">::</span><span class="na">warning</span><span class="p">(</span><span class="s1">&#39;Client error occurred&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;status_code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">(),</span>
                <span class="s1">&#39;url&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">fullUrl</span><span class="p">(),</span>
                <span class="s1">&#39;method&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">(),</span>
                <span class="s1">&#39;ip&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">ip</span><span class="p">(),</span>
                <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="nx">auth</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">(),</span>
                <span class="s1">&#39;timestamp&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">(),</span>
            <span class="p">]);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="53-middleware-de-normalizacion-de-entrada">5.3. Middleware de normalizaci贸n de entrada<a class="headerlink" href="#53-middleware-de-normalizacion-de-entrada" title="Permanent link">&para;</a></h3>
<p>La normalizaci贸n de datos de entrada mejora la consistencia (trim de espacios, normalizaci贸n de formato). Este middleware limpia y normaliza inputs antes de que lleguen al controlador.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">NormalizeInput</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// Normalizar datos de entrada</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$input</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$value</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">//  Trim espacios en blanco al inicio y final</span>
                <span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>

                <span class="c1">//  Normalizar m煤ltiples espacios en blanco a uno solo</span>
                <span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\s+/&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Reemplazar datos de la petici贸n</span>
        <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">merge</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Antipatr贸n: NO Uses <code>htmlspecialchars()</code> en la entrada</p>
<p><strong>NUNCA</strong> uses <code>htmlspecialchars()</code>, <code>strip_tags()</code> o similar en los datos de <strong>entrada</strong> antes de guardarlos en la base de datos.</p>
<p><strong> Mal (Antipatr贸n)</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// NO HACER: Escapar HTML en la entrada</span>
<span class="nv">$input</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nx">ENT_QUOTES</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$input</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span> <span class="c1">// Guardas &quot;&amp;lt;script&amp;gt;&quot; en lugar de &quot;&lt;script&gt;&quot;</span>
</code></pre></div>
<p>Problemas:</p>
<ol>
<li>P茅rdida de datos: Si guardas <code>htmlspecialchars("Caf茅 &amp; Copas")</code>, se convierte en <code>"Caf&amp;eacute; &amp;amp; Copas"</code></li>
<li>Doble escaping: Cuando lo muestres con Blade <code>{ { } }</code>, se ver谩 mal: <code>"Caf&amp;amp;eacute; &amp;amp;amp; Copas"</code></li>
<li>Datos corruptos: No puedes buscar, ordenar o comparar correctamente.</li>
</ol>
<p><strong> Correcto</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">//  GUARDAR: Datos limpios sin escapar</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// Guardas &quot;&lt;script&gt;&quot; tal cual</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">//  MOSTRAR: Blade escapa autom谩ticamente en la salida</span>
<span class="p">{{</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="p">}}</span>  <span class="c1">// Muestra &quot;&amp;lt;script&amp;gt;&quot; (seguro)</span>
</code></pre></div>
<p>Regla de oro:</p>
<ul>
<li><strong>Entrada</strong>: Valida y normaliza (trim, formato), pero <strong>NO escapes HTML</strong>.</li>
<li><strong>Salida</strong>: Blade escapa autom谩ticamente (protecci贸n XSS).</li>
<li><strong>Almacenamiento</strong>: Guarda los datos originales sin modificar.</li>
</ul>
</div>
<h2 id="6-testing-de-middleware">6. Testing de middleware<a class="headerlink" href="#6-testing-de-middleware" title="Permanent link">&para;</a></h2>
<p>Testear middleware es esencial para asegurar que las capas de seguridad y l贸gica funcionan correctamente. Laravel proporciona herramientas para simular peticiones y verificar respuestas f谩cilmente.</p>
<h3 id="61-test-basico">6.1. Test b谩sico<a class="headerlink" href="#61-test-basico" title="Permanent link">&para;</a></h3>
<p>Los tests b谩sicos de middleware verifican que las peticiones autorizadas pasen y las no autorizadas sean bloqueadas o redirigidas correctamente.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Http\Middleware\CheckUserRole</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CheckUserRoleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_middleware_allows_admin_access</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;admin&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_middleware_denies_non_admin_access</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;role&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;user&#39;</span><span class="p">]);</span>

        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">403</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_middleware_redirects_guests</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="62-test-de-rate-limiting">6.2. Test de Rate Limiting<a class="headerlink" href="#62-test-de-rate-limiting" title="Permanent link">&para;</a></h3>
<p>Los tests de <em>rate limiting</em> verifican que los l铆mites se apliquen correctamente, contando peticiones y rechazando las que excedan el l铆mite establecido.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Tests\Feature</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Tests\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Testing\RefreshDatabase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Cache</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">RateLimitProductCreationTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">RefreshDatabase</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">test_rate_limiting_works</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">\App\Models\User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>

        <span class="c1">// Crear 5 productos (l铆mite para usuario normal)</span>
        <span class="k">for</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">,</span> <span class="p">[</span>
                    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Product &#39;</span> <span class="o">.</span> <span class="nv">$i</span><span class="p">,</span>
                    <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
                <span class="p">]);</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="c1">// El sexto producto debe ser rechazado</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">actingAs</span><span class="p">(</span><span class="nv">$user</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Product 6&#39;</span><span class="p">,</span>
                <span class="s1">&#39;description&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span>
                <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
            <span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">429</span><span class="p">,</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">getStatusCode</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="7-mejores-practicas">7. Mejores pr谩cticas<a class="headerlink" href="#7-mejores-practicas" title="Permanent link">&para;</a></h2>
<p>Seguir buenas pr谩cticas en la organizaci贸n, documentaci贸n y configuraci贸n de middleware mejora la mantenibilidad del c贸digo y facilita el trabajo en equipo.</p>
<h3 id="71-organizacion-del-codigo">7.1. Organizaci贸n del c贸digo<a class="headerlink" href="#71-organizacion-del-codigo" title="Permanent link">&para;</a></h3>
<p>Organiza tu middleware en carpetas seg煤n su prop贸sito (Auth, API, Logging, Security). Esto facilita encontrar y mantener el c贸digo a medida que crece tu aplicaci贸n.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Agrupar middleware relacionado</span>
<span class="nx">app</span><span class="o">/</span><span class="nx">Http</span><span class="o">/</span><span class="nx">Middleware</span><span class="o">/</span>
<span class="nx"></span> <span class="nx">Auth</span><span class="o">/</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">CheckUserRole</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">CheckUserPermission</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">RedirectIfAuthenticated</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span> <span class="nx">Api</span><span class="o">/</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">ValidateApiRequest</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">TransformResponse</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">RateLimitApi</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span> <span class="nx">Logging</span><span class="o">/</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">LogUserActivity</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">LogErrors</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span>   <span class="nx"></span> <span class="nx">LogApiRequests</span><span class="o">.</span><span class="nx">php</span>
<span class="nx"></span> <span class="nx">Security</span><span class="o">/</span>
    <span class="nx"></span> <span class="nx">SanitizeInput</span><span class="o">.</span><span class="nx">php</span>
    <span class="nx"></span> <span class="nx">PreventXSS</span><span class="o">.</span><span class="nx">php</span>
    <span class="nx"></span> <span class="nx">ValidateCSRF</span><span class="o">.</span><span class="nx">php</span>
</code></pre></div>
<h3 id="72-documentacion-del-middleware">7.2. Documentaci贸n del middleware<a class="headerlink" href="#72-documentacion-del-middleware" title="Permanent link">&para;</a></h3>
<p>Documenta tus middleware con PHPDoc detallado explicando qu茅 hace, qu茅 par谩metros acepta y c贸mo usarlo. Esto es especialmente 煤til para middleware complejos o con par谩metros.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Middleware para verificar el rol del usuario</span>
<span class="sd"> * </span>
<span class="sd"> * @param string $role Rol requerido (admin, user, moderator)</span>
<span class="sd"> * </span>
<span class="sd"> * Uso:</span>
<span class="sd"> * Route::get(&#39;/admin&#39;, [AdminController::class, &#39;index&#39;])</span>
<span class="sd"> *     -&gt;middleware(&#39;role:admin&#39;);</span>
<span class="sd"> */</span>
<span class="k">class</span> <span class="nc">CheckUserRole</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle an incoming request.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$role</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="c1">// Implementaci贸n...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="73-configuracion-flexible">7.3. Configuraci贸n flexible<a class="headerlink" href="#73-configuracion-flexible" title="Permanent link">&para;</a></h3>
<p>Dise帽a middleware que acepte configuraci贸n mediante par谩metros. Esto aumenta la reutilizaci贸n y evita crear m煤ltiples middleware similares para casos ligeramente diferentes.</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;?php</span>
<span class="c1">// Configurar middleware con opciones</span>
<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/products&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">ProductController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;cache:30&#39;</span><span class="p">);</span> <span class="c1">// Cache por 30 minutos</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/admin&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">AdminController</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="s1">&#39;index&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;role:admin,moderator&#39;</span><span class="p">);</span> <span class="c1">// M煤ltiples roles</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="../404/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: 4.4. Autenticaci贸n b谩sica">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Anterior
              </span>
              <div class="md-ellipsis">
                4.4. Autenticaci贸n b谩sica
              </div>
            </div>
          </a>
        
        
          
          <a href="../406/" class="md-footer__link md-footer__link--next" aria-label="Siguiente: 4.6. Blade Components para Layouts">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Siguiente
              </span>
              <div class="md-ellipsis">
                4.6. Blade Components para Layouts
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M247.1 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L179.2 256 41.9 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Arturo Blasco - Creative Commons CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/arturoblasco" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.9.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>