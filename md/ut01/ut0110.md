---
title: 1.10. Puesta en marcha
---

# 1.10. Puesta en marcha

Para poder trabajar con un entorno de desarrollo local, hemos de prepararlo con las herramientas comentadas.

Vamos a proponer dos opciones; la **opción 1** será la instalación del paquete **XAMPP** para trabajar directamente en el equipo host; la **opción 2** será crear un contenedor con **Docker**.

> En realidad podríamos preparar el entorno de diferentes formas (directamente instalando en la máquina local con el paquete XAMPP, mediante máquina virtual con VirtualBox...) pero la utilización de *Docker* se ve justificada por su fácil utilización, la profundización en esta tecnología se verá en otros módulos de este curso (*Despliegue de aplicaciones web*) y su extensa utilización en la industria (en todo tipo de entornos).

!!!tip "XAMPP vs Docker en Windows"
    Si vas a trabajar con tu propio ordenador, *XAMPP* es una solución más sencilla que *Docker*, sobre todo si trabajas con *Windows* como sistema operativo.

!!!info "Versiones"
    A lo largo del curso vamos a usar `PHP 8.0`.

## **1. Opción 1: XAMPP**

*XAMPP* ( [https://www.apachefriends.org/es/index.html](https://www.apachefriends.org/es/index.html){:target="_blank"}) es una distribución compuesta con el software necesario para desarrollar en entorno servidor. Se compone de las siguientes herramientas en base a sus siglas:

- **X** para el sistema operativo (de ahí que se conozca también como *LAMP* o *WAMP*).
- **A** para Apache.
- **M** para *MySQL* / *MariaDB*. También incluye *phpMyAdmin* para la administración de la base de datos desde un interfaz web.
- **P** para *PHP*.
- **P** para *Perl*.

Desde la propia página se puede descargar el archivo ejecutable para el sistema operativo de nuestro ordenador. Se recomienda leer la FAQ de cada sistema operativo con instrucciones para su puesta en marcha.

## **2. Opción 2: Docker**

*Docker* ([https://www.docker.com](https://www.docker.com/){:target="_blank"}) es un gestor de contenedores; considerando un contenedor como un método de virtualización del sistema operativo.

El uso de contenedores requiere menos recursos que una máquina virtual, por lo tanto, su lanzamiento y detención son más rápidos que las máquinas virtuales.

Así pues, *Docker* permite crear, probar e implementar aplicaciones rápidamente, a partir de una serie de plantillas que se conocen como imágenes de *Docker*.

!!!inst "Instalación"
    === "<div style="text-align:center;"><img src="../../img/linux.png" alt="linux" width=40 height=40 /></div>"
    
        #### 1. Actualizar el Sistema
    
        Antes de comenzar, es recomendable actualizar los paquetes existentes en tu sistema:
        
        ```bash         
        sudo apt update         
        
        sudo apt upgrade -y         
        ```
        
        #### 2. Instalar las Dependencias
        Instala las dependencias necesarias para Docker:
        
        ```bash         
            sudo apt install -y ca-certificates curl gnupg lsb-release         
        ```
        
        #### 3. Agregar la Clave GPG de Docker
        Agrega la clave GPG oficial de Docker a tu sistema:
        
        ```bash         
        sudo mkdir -m 0755 -p /etc/apt/keyrings         
            
        curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg        
        ```
        
        #### 4. Agregar el Repositorio de Docker
        Añade el repositorio de Docker a tus fuentes de APT:
        
        ```bash         
        echo \           
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \           
        $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null         
        ```
        
        #### 5. Actualizar el Índice de Paquetes
        Actualiza el índice de paquetes de APT nuevamente para incluir el nuevo repositorio:
        
        ```bash         
        sudo apt update         
        ```
        
        #### 6. Instalar Docker Engine, Docker CLI y Containerd
        
        Ahora, instala Docker usando el comando apt:
        
        ```bash         
        sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin         
        ```
        
        #### 7. Verificar la Instalación de Docker
        
        Para verificar que Docker se haya instalado correctamente, ejecuta:
        
        ```bash         
        sudo docker --version         
        ```
        
        Deberías ver la versión de Docker instalada.
        
        #### 8. Permitir Ejecución de Docker sin Sudo (Opcional)
        
        Si quieres ejecutar Docker sin usar`sudo`, agrega tu usuario al grupo `docker`:
        
        ```bash         
        sudo usermod -aG docker $USER         
        ```
        
        Después de ejecutar este comando, cierra la sesión y vuelve a iniciarla para que los cambios tengan efecto.
        
        #### 9. Probar Docker
        
        Verifica que Docker esté funcionando correctamente ejecutando un contenedor de prueba:
        
        ```bash         
        docker run hello-world         
        ```
        
        Este comando descargará una imagen de prueba y ejecutará un contenedor que debería mostrar un mensaje de confirmación en la terminal.
        
        #### 10. Instalar Docker Desktop en Ubuntu (Opcional)
        
        Si deseas usar Docker Desktop en Ubuntu, sigue estos pasos adicionales:
        
        &nbsp;&nbsp;10.1) **Descargar Docker Desktop para Linux**: Visita la página de descarga de Docker Desktop y descarga la versión para Linux.
        
        &nbsp;&nbsp;10.2) **Instalar Docker Desktop**: Descomprime el archivo descargado y ejecuta el instalador:
        
        ```bash            
        sudo apt-get install ./docker-desktop-<version>-<arch>.deb            
        ```
        
        &nbsp;&nbsp;10.3) **Ejecutar Docker Desktop**: Inicia Docker Desktop desde tu entorno gráfico o ejecutando `docker-desktop` en la terminal.
        
        &nbsp;&nbsp;10.4) **Configurar Docker Desktop**: Cuando se inicie Docker Desktop por primera vez, puedes configurarlo para usar WSL 2 o bien ejecutar contenedores nativos en Linux.
        
        #### 11. Configurar Docker Desktop (Opcional)
        
        Si deseas hacer configuraciones adicionales como la cantidad de recursos que Docker puede usar, puedes hacerlo desde la interfaz gráfica de Docker Desktop.
        
        Con estos pasos, deberías tener Docker y Docker Desktop completamente instalados y listos para usar en tu sistema Ubuntu.`<hr>`
        
        Si aún así no se pudiera lanzar Docker Desktop en Ubuntu, podemos instalar el **contenedor Portainer** (puedes ver cómo funciona en el siguiente punto **docker de gestión de dockers Portainer**).
        
    === "<div style="text-align:center;"><img src="../../img/windows.png" alt="windows" width=40 height=40 " /></div>"
    
        #### 1. Instalación de Docker-Desktop
        Para una instalación en Windows lo ideal es instalar la aplicación **Docker Desktop** ( [https://www.docker.com/products/docker-desktop](https://www.docker.com/products/docker-desktop){:target="_blank"}  ) en nuestros entornos de desarrollo (el cual ya incluye en núcleo de *Docker* y la herramienta *Docker Compose*).
        
        Esta instalación requiere de un software adicional **WSL2**, el cual es un subsistema de *Linux* dentro de *Windows*; [aquí](https://learn.microsoft.com/es-es/windows/wsl/install){:target="_blank"}  podemos consultar sus métodos de instalación. Por suerte, con la misma instalación de *Docker Desktop*, viene también la de *WSL* (solo deberemos tener en cuenta tener el check de instalación activado).
    
        <div style="text-align: center;"><figure><img src="../../img/ut01/docker_desktop_wsl2.png" alt="Check para activación de WSL" style="zoom:70%; border: 2px solid #fff2c9;"/><figcaption style="font-size: 13px; color: #bd8f04;">Check para activación de WSL</figure></div>

        Cuando termine la instalación, reinicia tu máquina.
        
        <div style="text-align: center;"><figure><img src="../../img/ut01/dockerdesktop.png" alt="dockerdesktop" style="zoom:80%;" /><figcaption style="font-size: 13px; color: #bd8f04;">Interfaz programa Docker Desktop</figcaption></figure></div>
        
        #### 2. Verificar la instalación
        
        Una vez Docker esté instalado, abre **PowerShell** o **Command Prompt** y verifica la instalación:
        
        ```powershell         
        docker --version         
        
        docker-compose --version         
        ```
    
        #### 3. Crear o abrir el archivo`docker-compose.yml`
        
        Asegúrate de tener un archivo `docker-compose.yml` en el directorio en el que vas a trabajar. Este archivo define la configuración de tus servicios.
        
        Ejemplo de un archivo docker-compose.yml sencillo:
        
        ```yaml           
        version: '3.8'

        services:
          web:
            image: php:8.2-apache
            container_name: apache_php
            ports:
              - "8081:80"   
        ```
    
        #### 4. Levantar el contenedor usando Docker Compose
        
        &nbsp;&nbsp;4.1) Abre una ventana de PowerShell, Command Prompt o Terminal (si usas WSL).
        
        &nbsp;&nbsp;4.2) Navega al directorio donde se encuentra tu archivo docker-compose.yml.
        
        ```powershell         
        cd ruta/al/directorio         
        ```

        &nbsp;&nbsp;4.3) Una vez estés en el directorio adecuado, ejecuta el siguiente comando para levantar los servicios definidos en el archivo:
        
        ```powershell         
        docker-compose up -d         
        ```
    
        #### 5. Verificar que los contenedores están corriendo
        
        Después de ejecutar docker-compose up, puedes verificar que los contenedores están en ejecución con:
        
        ```powershell         
        docker ps         
        ```
        
        Si todo está correcto, deberías ver los contenedores definidos en el archivo `docker-compose.yml` listados.`<br />`
    
        #### 6. Acceso a los servicios
        
        Si el archivo`docker-compose.yml` incluye servicios con puertos expuestos (como en el ejemplo de Nginx), puedes acceder a ellos desde tu navegador usando localhost y el puerto definido, por ejemplo:

        ```powershell        
        http://localhost:8080         
        ```
        
???note "Portainer: docker de gestión de dockers"
    Portainer es una **forma cómoda de gestionar entornos de contenedores distribuidos**.
    
    El software se instala como un contenedor Docker y, por tanto, se ejecuta prácticamente en cualquier lugar. Mostramos la rutina de instalación y aportamos útiles consejos.
    
    ### Instalar
    
    #### En Linux
    ```sh     
    $ sudo docker volume create portainer_data     
       
    $ sudo docker run -d -p 8000:8000 -p 9443:9443 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:latest     
    ```

    <div style="text-align: center;"><figure><img src="../../img/ut01/docker_portainer1.png" alt="docker_portainer1" style="zoom:100%;" /><figcaption style="font-size: 13px; color: #bd8f04;">Instalación del contenedor Portainer desde terminal.</figcaption></figure></div>
    

    #### En Windows
    ```sh     
    docker volume create portainer_data     
       
    docker run -d -p 8000:8000 -p 9443:9443 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce:latest     
    ```    

    ### Lanzar
    
    Como otro contenedor, podremos acceder a él mediante un navegador (Firefox, Chrome, ...) introduciendo la URL: 
    
    ```sh
    https://localhost:9443
    ```
    
    <div style="text-align: center;"><figure><img src="../../img/ut01/docker_portainer2.png" alt="docker_portainer2" style="zoom:80%; border: 2px solid #fff2c9;" /><figcaption style="font-size: 13px; color: #bd8f04;">Acceso a docker Portainer desde el puerto 9000.</figcaption></figure></div>
    
    Si muestra el siguiente texto, debemos reiniciar el contenedor del Docker Portainer:

    ```sh
    docker restart portainer
    ```
    
    <div style="text-align: center;"><figure>``<img src="../../img/ut01/docker_portainer3.png" alt="docker_portainer3" style="zoom:80%; border: 2px solid #fff2c9;" /><figcaption style="font-size: 13px; color: #bd8f04;">Pestaña indicando reiniciar el docker Portainer.</figcaption></figure></div>
    
    Volvemos a acceder vía **`https://localhost:9443`**:
    
    <div style="text-align: center;"><figure><img src="../../img/ut01/docker_portainer4.png" alt="docker_portainer4" style="zoom:80%; border: 2px solid #fff2c9;" /><figcaption style="font-size: 13px; color: #bd8f04;">Pestaña de inicio de docker Portainer.</figcaption></figure></div>
    
    ### Funciona como un docker
    
    Para ver el ID de contenedor podemos listar los contenedores:
    
    ```sh     
    $ sudo docker ps -a     
    ```
    
    Para parar el contenedor:
    
    ```sh     
    $ sudo docker stop [ID]     
    ```
    
    Para volver a lanzar el contenedor:
    
    ```sh     
    $ sudo docker start [ID]     
    ```
    
A lo largo del curso iremos creando diferentes contenedores con los servicios necesarios, de manera que cada vez sólo trabajemos con el software mínimo.
        
Respecto a `Docker`, para escribir los apuntes hemos utilizado la version `20.10` y en Docker Compose la version `2.19`.
        
Finalmente, la versión de `Docker Desktop` que hemos utilizado es la `4.0`.
        
### 2.1. Plantilla Servidor Web + PHP
        
Docker se basa en el uso de imágenes para crear contenedores. *Docker Compose* simplifica el trabajo con múltiples contenedores, y por ello, para facilitar el arranque, nos centraremos en *Docker Compose* utilizando una plantilla que únicamente va a contener como servicios Apache/Nginx y PHP.
        
Para ello, vamos crear una carpeta de nombre `proyecto1`, y dentro de este el archivo **`docker-compose.yaml`** con:
        
!!!note "proyecto1 con distintos servidores en `docker-compose.yml`"
    
    === "Apache y PHP"
        
        * **Estructura del proyecto**:
        
        ```bash         
        proyecto1/         
        │         
        ├── docker-compose.yml         
        └── src/	# Carpeta del proyecto         
        ```
        
        * **Fichero `docker-compose.yml`**:
        
        ```yaml
        version: '3.8'

        services:
          web:
            image: php:8.2-apache
            container_name: apache_php
            ports:
              - "8081:80"
            volumes:
              - ./src:/var/www/html
            environment:
              APACHE_RUN_USER: www-data
              APACHE_RUN_GROUP: www-data
              APACHE_LOG_DIR: /var/log/apache2
            networks:
              - webnet

        networks:
          webnet:
            driver: bridge
        ```				     
    === "Nginx y PHP"         
        
        * **Estructura del proyecto**: 
        
        ```bash
        proyecto2/
        │
        ├── docker-compose.yml
        ├── .docker
        │   ├─── nginx
        │   │   └── conf.d
        │   │      └── php.conf  # Archivo configuración php en Nginx
        └── src/	# Carpeta del proyecto
        ```
        
        * **Fichero `docker-compose.yml`**:<br />
        
        ```yaml
        version: '3.8'
        
        services:
          nginx:
            image: nginx:1.19
            ports:
              - "8082:80"  # Asegúrate de que el puerto está correctamente mapeado
            volumes:
              - ./src:/var/www/php
              - ./.docker/nginx/conf.d:/etc/nginx/conf.d  # Configuración personalizada de Nginx
            depends_on:
              - php
            networks:
              - webnet
          php:
            image: php:8.0-fpm
            working_dir: /var/www/php
            volumes:
              - ./src:/var/www/php
            networks:
              - webnet
          networks:
            webnet:
              driver: bridge
        ```
        
        Asegúrate de que tu archivo de configuración de Nginx está correctamente configurado. Aquí hay un ejemplo básico que debes colocar en**./.docker/nginx/conf.d/default.conf**:
        
        ```yaml
        server {
            listen 80;
            server_name localhost;
            
            root /var/www/php;
            index index.php index.html index.htm;
            
            location / {
                try_files$uri $uri/ /index.php?$args;
            }
            
            location ~\.php$ {
                include fastcgi_params;
                fastcgi_pass php:9000;  # Asegúrate de que este nombre coincide con el nombre del servicio PHP
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            }
        }
        ```
    
        Dentro de la carpeta que contenga dicho archivo, hemos de crear una carpeta **`src`** donde colocaremos nuestro código fuente.
            
        Para facilitar la puesta en marcha, tenéis las plantillas de:
            
        - [**Apache/PHP**](../../sources/plantilla-ApachePhp.zip){:target="blank"} ([**versión 2**](../../sources/plantilla-ApachePhp2.zip){:target="blank"} con `a2enmod rewrite`) o
                  
        - [**Nginx/PHP**](../../sources/plantilla-NginxPhp.zip){:target="blank"}
                
        isponibles para su descarga.
                
???hint "Extra: órdenes en Docker"
    Cuando estemos listos, **lanzaremos el servicio** mediante:
    
    ```sh     
    docker-compose up -d     
    ```
    
    Docker Compose primero buscará la imagen definida en su sistema local, y si no puede encontrar la imagen, descargará la imagen desde Docker Hub. Verás un resultado como este:

    <div style="text-align:center;"><img src="../../img/ut01/docker-compose-up-d.png" alt="holamundo" style="zoom:80%; border: 2px solid #fff2c9;" /><figcaption style="font-size: 13px; color: #bd8f04;">`Descarga e instalación de imágenes de docker-compose.yml`</figcaption></figure></div>

    Si queremos ver el contenido de los archivos de **log** del servicio utilizaremos:
    
    ```sh     
    docker-compose logs -f     
    ```
    
    Para **copiar un archivo** desde nuestro sistema al interior del contenedor:
    
    ```sh     
    docker cp ./miFichero idContenedor:/tmp     
    ```
    
    Y al revés, si queremos consultar un archivo contenido dentro de un contenedor, lo copiaremos a nuestro sistema:
    
    ```sh     
    docker cp idContenedor:/tmp/archivoAConsultar.txt ./     
    ```
    
    Finalmente, si queremos acceder a un terminal interactivo dentro del contenedor:
    
    ```sh     
    docker exec -it nombreContenedor bash     
    ```
    
    Otros comandos que podemos llegar a utilizar son:
    
    - `docker ps`: Ver los contenedores que se estan ejecutando.
    - `docker ps -a`: Ver todos los contenedores.
    - `docker start nombreContenedor`: Arrancar un contenedor.
    - `docker images`: Ver las imágenes que tenemos descargadas.
    - `docker stop $(docker ps -a -q)`: Detener todos los contenedores en ejecución.
    - `docker rm $(docker ps -a -q)`: Eliminar todos los contenedores detenidos.


!!!info "Docker stack"
    Existen diversas opciones mediante Docker que ofrecen soluciones completas y empaquetadas para todo el *stack* de desarrollo. En posteriores sesiones podremo utilizar tanto *Devilbox* ([http://devilbox.org](http://devilbox.org/){:target="_blank"}) como Laradock ([https://laradock.io](https://laradock.io/){:target="_blank"}).

!!!info "... pero quiero saber cómo funciona ..."
    En el módulo de "*Despliegue de aplicacione*s" estudiaréis en profundidad, además de *Docker*, *Apache* y otros servicios que nos servirán de ayuda para el desarrollo en entorno servidor.

## 3. Editor de código

En este curso vamos a emplear ***Visual Studio Code*** ([https://code.visualstudio.com](https://code.visualstudio.com/){:target="_blank"}) como editor de código fuente. Existen otras alternativas, siendo *PhpStorm* el IDE  más conocido (pero de pago). Otra posibilidad es utilizar *Eclipse*, aunque es un entorno bastante pesado.

*VSCode* es un editor de código fuente que se complementa mediante extensiones. Para facilitar el trabajo a lo largo del curso vamos a utilizar las siguientes **extensiones**:

- **PHP Debug**: para la depuración de código PHP. Permite conectar VSCode a un servidor de depuración PHP y proporciona herramientas para inspeccionar variables, establecer puntos de interrupción y realizar un seguimiento detallado del flujo de ejecución.
- **PHP IntelliSense**: extensión fundamental, aporta mucha velocidad de escritura gracias al «*intellisense*». Mejora la codificación al proporcionar sugerencias inteligentes de código y completar automáticamente fragmentos de código mientras escribes en PHP.
- **Php Intelephense**: ofrece características avanzadas para desarrolladores PHP, como autocompletado inteligente, análisis estático y soporte para PHPDoc. Ayuda a detectar errores y a escribir código más eficiente.
- **PHP DocBlocker**: simplifica la creación de comentarios tipo *DocBlock* para sus funciones y métodos PHP. Con solo presionar un atajo de teclado, puede generar rápidamente documentación legible y útil para tu código.
- **PHP Code Sniffer**: asegura que el código PHP cumpla con los estándares de codificación establecidos. Puedes personalizar las reglas según las necesidades de tu proyecto.
- **PHP CS Fixer**: automatiza la corrección de problemas de formato en tu código PHP, manteniéndolo limpio y coherente con facilidad.
- **PHP Namespace Resolver**
- **Docker**

En la siguiente sesión comenzaremos a utilizar **Intelephense pero en esta sesión nos vamos a centrar en Docker** (más adelante instalaremos nuevas extensiones).

Por ejemplo, si abrimos la extensión de *Docker*, podréis visualizar tanto los contenedores como las imágenes de vuestro sistema. Desde cada contenedor, mediante clic derecho, podemos iniciar/detener/reiniciar cada contenedor, así como ver su contenido o abrir un terminal dentro del mismo:

<div style="text-align: center;"><figure><img src="../../img/ut01/vscodedocker.png" alt="vscodedocker" style="zoom:65%;" /><figcaption style="font-size: 13px; color: #bd8f04;">Extensión Docker en Visual Studio Code</figcaption></figure></div>

### 3.1. Configurar llaves PHP en VS Code

Ir a *Archivo → Preferencias → Configurar fragmentos de usuario* (*File → Preferences → User Snippets*) seleccionar la opción **html** y agregar el *snippet* en el fichero `html.json`:

```sh
"php": {
    "prefix": "php",
    "body": [
        "<?php",
        "$1",
        "?>"
    ],
    "description": "php tag"
}
```

A partir de ahora podremos abreviar la introducción de las etiquetas `<?php` y `?>` en *VS Code* introduciendo **php + TAB**.

## 4. Hola Mundo

Y como no, nuestro primer ejemplo será un *Hola Mundo* en PHP.

Si nombramos el archivo como index.php, al acceder a http://localhost automáticamente cargará el resultado:

=== "Php"
    ```Php     
    <!DOCTYPE html>     
    <html lang="es">     
    <head>         
        <meta charset="UTF-8">         
        <meta name="viewport" content="width=device-width, initial-scale=1.0">         
        <title>Hola Mundo</title>     
    </head>     
    <body>         
    <?php             
    echo "Hola Mundo";         
    ?>     
    </body>     
    </html>    
    ```
=== "Resultado"
    <div style="text-align: center;"><figure><img src="../../img/ut01/holamundo.png" alt="holamundo" style="zoom:70%; border: 2px solid #fff2c9;" /><figcaption style="font-size: 13px; color: #bd8f04;">`Página en php: Hola Mundo.`</figcaption></figure></div>
