# 2.6. Datos Mock: El Simulador de Base de Datos para Desarrollo √Ågil

En el desarrollo de aplicaciones web, especialmente durante las fases iniciales de un proyecto, es una pr√°ctica profesional trabajar con **datos mock** (datos de prueba simulados) en lugar de depender inmediatamente de una base de datos real. Los datos mock permiten desarrollar y probar funcionalidades de forma √°gil, sin la complejidad inicial de configurar y mantener una base de datos completa.

???+examplelaravel "Analog√≠a: Simulador de Vuelo para Entrenar Pilotos"

    **¬°Imagina que est√°s entrenando pilotos para una aerol√≠nea!**

    * ‚úàÔ∏è **Sin simulador (el camino peligroso y caro)** Usas un avi√≥n real Boeing 737 valorado en 100 millones de euros, quemas combustible real (miles de euros/hora), y arriesgas vidas si el piloto en entrenamiento comete errores.
    * üéÆ **Con simulador de vuelo (el camino profesional)** Usas datos mock: clima simulado, aeropuertos virtuales, emergencias artificiales, pasajeros ficticios. ¬°Son falsos, pero el piloto aprende TODAS las maniobras sin riesgo ni coste!
    * ‚úÖ **Lo real funciona con lo simulado** La cabina es real, los controles son reales, los procedimientos son reales, el sistema de navegaci√≥n es real. Solo los "datos del vuelo" son simulados. ¬°Pero todo funciona exactamente igual!
    * üéâ **El primer vuelo real** El piloto entrenado sube al avi√≥n verdadero. ¬°Sabe hacer TODO porque lo practic√≥ mil veces! Solo los datos son ahora reales.
    * üí° **La gran ventaja** Has entrenado cientos de pilotos, probado miles de escenarios (tormentas, fallos de motor, aterrizajes de emergencia) sin gastar millones ni arriesgar vidas.

    **¬°As√≠ funcionan los datos mock en Laravel! Te permiten construir y probar TODO sin depender de una base de datos real.**

Los datos mock ofrecen m√∫ltiples beneficios durante el desarrollo:

1. **Desarrollo r√°pido**: No requiere configuraci√≥n de base de datos
2. **Datos consistentes**: Mismos datos para todos los desarrolladores del equipo
3. **F√°cil testing**: Datos predecibles para pruebas
4. **Simplicidad**: Estructura simple y f√°cil de entender
5. **Versionado**: Los datos mock se pueden versionar con Git
6. **Centralizaci√≥n**: Un solo lugar para modificar los datos de toda la aplicaci√≥n
7. **Sin duplicaci√≥n**: Evita repetir datos en cada controlador

Trabajo en Equipo

üë• **Cuando varios desarrolladores trabajan en el mismo proyecto:**

* **Sin datos mock centralizados**: Cada desarrollador crea sus propios datos de prueba. Ana tiene 5 productos, Carlos tiene 8, y Mar√≠a tiene 3. Caos total cuando intentan integrar su c√≥digo.
* **Con datos mock centralizados**: Todos comparten `mock-products.php` con los mismos 10 productos. El c√≥digo de Ana funciona en el ordenador de Carlos sin cambios.
* **Cambios coordinados**: Si Ana actualiza el precio de un producto en el mock, autom√°ticamente Carlos y Mar√≠a ven ese cambio en su pr√≥ximo `git pull`.
* **Testing consistente**: Las pruebas funcionan igual para todos porque usan los mismos datos base.

¬°Los datos mock centralizados son como tener un "idioma com√∫n" para todo el equipo!

## 6.1. Estructura de Datos Mock

En Laravel, los datos mock se organizan t√≠picamente en el directorio `database/data/`. Aqu√≠ es donde se almacenan los archivos PHP que devuelven arrays con los datos simulados.

Cada archivo mock devuelve un array PHP con la estructura de datos correspondiente. A veces puede ser √∫til tener un array asociativo con IDs como claves para facilitar b√∫squedas r√°pidas.

* Array de elementos simples

  

  ```php
  <?php

  return [
      [
          'id' => 1,
          'name' => 'Categor√≠a 1',
          'description' => 'Descripci√≥n de la categor√≠a 1'
      ],
      [
          'id' => 2,
          'name' => 'Categor√≠a 2',
          'description' => 'Descripci√≥n de la categor√≠a 2'
      ],
  ];
  ```
* Array asociativo con IDs como claves

  

  ```php
  <?php

  return [
      1 => [
          'name' => 'Producto 1',
          'description' => 'Descripci√≥n del producto 1'
          'category_id' => 1
      ],
      2 => [
          'name' => 'Producto 2',
          'description' => 'Descripci√≥n del producto 2'
          'category_id' => 1
      ],
  ];
  ```

Dependiendo de las necesidades, puedes elegir el formato que mejor se adapte a tu caso.

Helper database\_path()

Laravel proporciona el helper `database_path()` que devuelve la ruta completa al directorio `database/` de la aplicaci√≥n. Esto permite cargar archivos de forma segura independientemente del sistema operativo.

## 6.2. Traits: Reutilizando C√≥digo entre Controladores

### 6.2.1. ¬øQu√© es un Trait?

Un **trait** es un mecanismo de reutilizaci√≥n de c√≥digo en PHP que permite compartir m√©todos entre m√∫ltiples clases. Es especialmente √∫til cuando varias clases necesitan la misma funcionalidad pero no pueden heredar de una clase com√∫n.

???+examplelaravel "Analog√≠a: Trait como Sistema Centralizado de Equipamiento del Aeropuerto"

    ‚úàÔ∏è **Imagina un aeropuerto internacional con m√∫ltiples aerol√≠neas operando:**

    * **M√∫ltiples aerol√≠neas** operan vuelos diferentes desde el mismo aeropuerto
    * **Todas necesitan** los mismos servicios b√°sicos: sistema de check-in, esc√°neres de seguridad, equipos de comunicaci√≥n, tractores de equipaje
    * **Sin trait**: Cada aerol√≠nea instala su propio check-in, sus propios esc√°neres, sus propios tractores. Si el esc√°ner falla, hay que reparar 5 esc√°neres diferentes.
    * **Con trait**: El aeropuerto proporciona infraestructura centralizada compartida. Un esc√°ner para todas las aerol√≠neas. Una aver√≠a = una reparaci√≥n.
    * **A√±ades un nuevo sistema de embarque automatizado**: Autom√°ticamente todas las aerol√≠neas pueden usarlo sin que tengas que instalarlo puerta por puerta.
    * **Cada aerol√≠nea** sigue gestionando sus propios vuelos, rutas y pasajeros (su l√≥gica espec√≠fica), pero comparte la infraestructura b√°sica del aeropuerto.

    ¬°As√≠ funcionan los traits! Son la "infraestructura compartida del aeropuerto" que todos los controladores usan sin duplicar c√≥digo.

Los traits ofrecen m√∫ltiples ventajas cuando se trabaja con datos mock:

1. **DRY (Don't Repeat Yourself)**: Elimina la duplicaci√≥n de c√≥digo
2. **Mantenimiento centralizado**: Un solo lugar para modificar la l√≥gica de carga
3. **Consistencia**: Todos los controladores usan los mismos m√©todos
4. **Escalabilidad**: F√°cil a√±adir nuevos m√©todos al trait
5. **Legibilidad**: Los controladores se enfocan en su l√≥gica espec√≠fica
6. **Testing**: M√°s f√°cil probar la l√≥gica de carga de datos

### 6.2.2. Crear el Trait para Datos Mock

Los traits son ideales para centralizar los m√©todos de carga de datos mock que varios controladores necesitan.

Si varios controladores necesitan cargar datos desde archivos mock, en lugar de repetir los mismos m√©todos en cada controlador, se puede crear un trait `LoadsMockData` que contenga todos estos m√©todos.



```php
<?php
// Fichero: app/Traits/LoadsMockData.php

namespace App\Traits;

trait LoadsMockData
{
    /**
     * Load categories from mock file
     */
    protected function getCategories(): array
    {
        return require database_path('data/mock-categories.php');
    }


    /**
     * Load products from mock file
     */
    protected function getProducts(): array
    {
        return require database_path('data/mock-products.php');
    }

    /**
     * Load all mock data at once
     */
    protected function getAllMockData(): array
    {
        return [
            'categories' => $this->getCategories(),
            'offers' => $this->getOffers(),
            'cart' => $this->getCart(),
            'products' => $this->getProducts(),
        ];
    }
}
```

### 6.2.3. Uso de Traits

Los traits se incluyen en una clase usando la palabra clave `use`. Esto hace que todos los m√©todos del trait est√©n disponibles en la clase.



```php
<?php

namespace App\Http\Controllers;

use App\Traits\LoadsMockData;
use Illuminate\Http\Request;
use Illuminate\View\View;

class ProductController extends Controller
{
    use LoadsMockData; // ¬°Una l√≠nea da acceso a todos los m√©todos!

    
    public function index(): View
    {
       // Implementaci√≥n para listar productos
       $products = $this->getProducts(); // M√©todo del trait
       // ... l√≥gica adicional ...
    }

    // Otros m√©todos del controlador...
}
```

## 6.3. Funciones Avanzadas con Datos Mock

### 6.3.1. Filtrado de Datos con array\_filter()

La funci√≥n `array_filter()` de PHP permite filtrar elementos de un array seg√∫n una condici√≥n.



```php
$products = $this->getProducts();
$filtered = array_filter($products, function($product) {
    return $product['price'] > 50;  // Filtra productos con precio mayor a 50
});
```

### 6.3.2 Transformaci√≥n de Datos con array\_map()

La funci√≥n `array_map()` de PHP permite transformar cada elemento de un array aplicando una funci√≥n a cada uno.



```php
$products = $this->getProducts();
$categories = $this->getCategories();
$enrichedProducts = array_map(function($product) use ($categories) {
    $product['category'] = $categories[$product['category_id']] ?? null;    
    return $product;
}, $products);


// Retorna productos enriquecidos con datos de categor√≠a

[
    1 => [
        'name' => 'Producto 1',
        'description' => 'Descripci√≥n del producto 1'
        'category_id' => 1,
        'category' => [
            'name' => 'Categor√≠a 1',
            'description' => 'Descripci√≥n de la categor√≠a 1'
        ]
    ],
    2 => [
        'name' => 'Producto 2',
        'description' => 'Descripci√≥n del producto 2',
        'category_id' => 1,
        'category' => [
            'name' => 'Categor√≠a 1',
            'description' => 'Descripci√≥n de la categor√≠a 1'
        ]
    ],
]
```

### 6.3.3. B√∫squeda por ID con Operador ??

El operador `??` (null coalescing) es perfecto para buscar elementos por ID:



```php
// Buscar producto con ID 5
$product = $products[3] ?? null;

// Si existe: $product tiene los datos
// Si no existe: $product es null

// Luego validar
if (!$product) {
    abort(404, 'Producto no encontrado');
}
```
