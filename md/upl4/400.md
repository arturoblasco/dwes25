# Introducci贸n

## S铆ntesis de la sesi贸n

Esta sesi贸n se enfoca en la interacci贸n segura y eficiente entre la aplicaci贸n Laravel y los usuarios finales, dominando las t茅cnicas m谩s importantes para crear interfaces robustas y seguras. 

Se aprende a dise帽ar y gestionar **formularios HTML** seguros que protejan contra ataques como CSRF, implementando **validaci贸n** robusta de datos en m煤ltiples capas. 

Se domina el **sistema de sesiones** para mantener el estado del usuario entre peticiones, implementando carritos de compra y notificaciones flash. 

Se implementa **autenticaci贸n completa** con Laravel Breeze para proteger rutas y recursos sensibles. 

Se explora el **almacenamiento de archivos** para gestionar im谩genes de productos de forma segura. Se crean **middleware personalizados** para logging y validaciones espec铆ficas. 

Se comprende la coexistencia de **layouts tradicionales y componentes Blade** en proyectos reales. 

El objetivo es crear aplicaciones web completas y seguras que manejen la entrada del usuario de manera profesional.

## Contenidos de la Sesi贸n 4

1. **Formularios Seguros con Laravel** Se estudian los conceptos b谩sicos de los formularios HTML y se crean formularios seguros usando las herramientas de Laravel, implementando protecci贸n CSRF autom谩tica y mejores pr谩cticas de seguridad.
2. **Sistema de Validaci贸n** Se domina el sistema de validaci贸n robusto de Laravel, aprendiendo a crear reglas personalizadas, manejar errores y proporcionar mensajes claros al usuario tanto en frontend como backend.
3. **Manejo de Sesiones y Estado** Se gestionan sesiones de usuario y cookies para mantener el estado entre peticiones, implementando sistemas de notificaciones y manejo de errores elegantes.
4. **Autenticaci贸n B谩sica** Se implementan sistemas de autenticaci贸n simples, aprendiendo sobre login, logout, registro de usuarios y protecci贸n de rutas sensibles.
5. **Middleware Personalizado** Se crea middleware personalizado para aplicar l贸gica com煤n como logging, rate limiting y validaciones espec铆ficas, manteniendo el c贸digo organizado y reutilizable.
6. **Blade Components para Layouts** Se exploran las dos sintaxis de layouts en Laravel (tradicional con @extends y moderna con componentes), comprendiendo el concepto de $slot, slots nombrados, y c贸mo ambas sintaxis conviven en proyectos reales.
7. **Sistema de Almacenamiento de Archivos** Se domina el sistema de almacenamiento de Laravel para gestionar archivos de forma segura. Se aprende a configurar discos de almacenamiento, crear enlaces simb贸licos, validar y guardar archivos subidos, y eliminar archivos antiguos.


## Objetivos de la Sesi贸n 4

* **Objetivo 1**: Comprender los fundamentos de los formularios web y crear formularios seguros con Laravel, implementando protecci贸n CSRF y mejores pr谩cticas de seguridad.
* **Objetivo 2**: Dominar el sistema de validaci贸n de Laravel, creando reglas personalizadas, validando archivos subidos y manejando errores de manera elegante tanto en frontend como backend.
* **Objetivo 3**: Gestionar sesiones y estado del usuario de manera segura, implementando carritos de compra, listas de deseos y sistemas de notificaciones flash.
* **Objetivo 4**: Implementar sistemas de autenticaci贸n completos con Laravel Breeze para proteger rutas y recursos sensibles, gestionando login, registro y logout.
* **Objetivo 5**: Crear middleware personalizado para aplicar l贸gica com煤n como logging de actividad, rate limiting y validaciones espec铆ficas.
* **Objetivo 6**: Comprender la coexistencia de sintaxis tradicional (@extends) y moderna (componentes) en layouts Blade, entendiendo el concepto de $slot y slots nombrados.
* **Objetivo 7**: Dominar el sistema de almacenamiento de archivos de Laravel, configurando discos, creando enlaces simb贸licos y gestionando archivos de forma segura.

---

| Objetivos Generales del Curso | Objetivos de la Sesi贸n 4 |
| --- | --- |
| **Objetivo General 2** |**Objetivo 1**: Comprender formularios seguros | 
| **Objetivo General 2** |**Objetivo 2**: Dominar validaci贸n Laravel |
| **Objetivo General 2** |**Objetivo 3**: Gestionar sesiones y estado |
| **Objetivo General 2** |**Objetivo 4**: Implementar autenticaci贸n |
| **Objetivo General 2** |**Objetivo 5**: Crear middleware personalizado |
| **Objetivo General 2** |**Objetivo 6**: Comprender layouts Blade (tradicional vs componentes) |
| **Objetivo General 2** |**Objetivo 7**: Dominar almacenamiento de archivos |


## Recursos adicionales

### Documentaci贸n oficial

* [Laravel 12.x Documentation](https://laravel.com/docs/12.x){:target="_blank"} - Documentaci贸n oficial completa
* [Laravel Validation](https://laravel.com/docs/12.x/validation){:target="_blank"} - Gu铆a oficial de validaci贸n
* [Laravel Authentication](https://laravel.com/docs/12.x/authentication){:target="_blank"} - Documentaci贸n oficial de autenticaci贸n
* [Laravel Middleware](https://laravel.com/docs/12.x/middleware){:target="_blank"} - Gu铆a oficial de middleware
* [Laravel Blade Components](https://laravel.com/docs/12.x/blade#components){:target="_blank"} - Documentaci贸n de componentes Blade
* [Laravel File Storage](https://laravel.com/docs/12.x/filesystem){:target="_blank"} - Gu铆a oficial de almacenamiento de archivos
* [Laravel Session](https://laravel.com/docs/12.x/session){:target="_blank"} - Documentaci贸n oficial de sesiones

### Seguridad web

* [OWASP Top 10](https://owasp.org/www-project-top-ten/){:target="_blank"} - Principales vulnerabilidades web
* [CSRF Protection](https://owasp.org/www-community/attacks/csrf){:target="_blank"} - Informaci贸n sobre protecci贸n CSRF
* [Web Security Best Practices](https://developer.mozilla.org/en-US/docs/Web/Security){:target="_blank"} - Mejores pr谩cticas de seguridad web
* [Form Security](https://developer.mozilla.org/en-US/docs/Web/Security/Securing_your_site){:target="_blank"} - Seguridad en formularios

### Recursos de aprendizaje

* [Laracasts](https://laracasts.com){:target="_blank"} - Tutoriales en video de Laravel
* [Laravel News](https://laravel-news.com){:target="_blank"} - Noticias y art铆culos sobre Laravel
* [Form Validation Best Practices](https://web.dev/sign-up-form-best-practices/){:target="_blank"} - Mejores pr谩cticas de validaci贸n



???teolaravel "Glosario t茅cnico"
	| T茅rmino | Definici贸n |
	| --- | --- |
	| **Autenticaci贸n** | Proceso de verificar la identidad de un usuario (login/logout). |
	| **Autorizaci贸n** | Proceso de determinar qu茅 acciones puede realizar un usuario autenticado. |
	| **Componente Blade** | Clase reutilizable que encapsula l贸gica y vista para elementos de interfaz, con sintaxis moderna `<x-nombre>`. |
	| **Cookie** | Peque帽o archivo de texto almacenado en el navegador del usuario para mantener informaci贸n. |
	| **CSRF** | Cross-Site Request Forgery - ataque que explota la confianza de un sitio web en un usuario autenticado. |
	| **Disco de Almacenamiento** | Ubicaci贸n configurada donde Laravel guarda archivos (local, public, s3). |
	| **Enlace Simb贸lico** | "Portal" que conecta `public/storage` con `storage/app/public` para hacer archivos accesibles p煤blicamente. |
	| **Formulario Web** | Elemento HTML que permite a los usuarios enviar datos al servidor de manera estructurada. |
	| **Laravel Breeze** | Paquete oficial de Laravel que implementa autenticaci贸n completa con vistas, controladores y rutas preconfiguradas. |
	| **Mensaje Flash** | Dato almacenado en sesi贸n que solo persiste para la siguiente petici贸n, 煤til para notificaciones. |
	| **Middleware** | Capa de software que procesa las peticiones HTTP antes de que lleguen a los controladores. |
	| **Rate Limiting** | T茅cnica que limita la frecuencia de peticiones para prevenir abuso. |
	| **Sanitizaci贸n** | Proceso de limpiar y validar datos de entrada para prevenir ataques de inyecci贸n. |
	| **Sesi贸n** | Mecanismo que permite mantener informaci贸n del usuario entre m煤ltiples peticiones HTTP. |
	| **Slot** | Variable especial en componentes Blade que representa el contenido pasado entre las etiquetas del componente. |
	| **Storage Facade** | Interfaz de Laravel para gestionar archivos (guardar, leer, eliminar) de forma consistente en diferentes discos. |
	| **Validaci贸n** | Proceso de verificar que los datos ingresados cumplen con los criterios especificados. |



???teolaravel "FAQ (Preguntas Frecuentes sobre la Pr谩ctica)"
	* ==**P: 驴Por qu茅 es importante la protecci贸n CSRF en los formularios?**==
	+ **R:** CSRF protege contra ataques donde un sitio malicioso realiza acciones en nombre del usuario autenticado sin su conocimiento, explotando la confianza del navegador.
  
	* ==**P: 驴Cu谩l es la diferencia entre validaci贸n del frontend y backend?**==
	+ **R:** La validaci贸n del frontend mejora la experiencia del usuario con feedback inmediato, pero la validaci贸n del backend es esencial para la seguridad y debe ser la fuente de verdad.
	* ==**P: 驴C贸mo funciona el sistema de validaci贸n de Laravel?**==
	+ **R:** Laravel proporciona reglas de validaci贸n predefinidas y permite crear reglas personalizadas, devolviendo errores estructurados que se pueden mostrar f谩cilmente al usuario.
	* ==**P: 驴Qu茅 son las sesiones y por qu茅 son importantes?**==
	+ **R:** Las sesiones permiten mantener informaci贸n del usuario entre peticiones HTTP (que es stateless), esencial para funcionalidades como carritos de compra o estados de login.
	* ==**P: 驴Cu谩ndo debo usar middleware personalizado?**==
	+ **R:** Cuando necesitas aplicar la misma l贸gica a m煤ltiples rutas (logging, autenticaci贸n, rate limiting) o cuando quieres mantener el c贸digo organizado y reutilizable.
	* ==**P: 驴C贸mo puedo mejorar la seguridad de mis formularios?**==
	+ **R:** Usando protecci贸n CSRF, validaci贸n robusta, sanitizaci贸n de datos, rate limiting, y siguiendo las mejores pr谩cticas de OWASP para formularios web.
	* ==**P: 驴Qu茅 es la diferencia entre autenticaci贸n y autorizaci贸n?**==
	+ **R:** La autenticaci贸n verifica "qui茅n eres" (login), mientras que la autorizaci贸n determina "qu茅 puedes hacer" (permisos y roles).
	* ==**P: Error "Las im谩genes no se muestran en el navegador" despu茅s de subirlas**==
	+ **R:** Verifica los siguientes pasos:

		1. Ejecutaste `sail artisan storage:link` para crear el enlace simb贸lico
		2. El archivo se guard贸 en `storage/app/public/products/` con `store('products', 'public')`
		3. En la vista usas `asset('storage/' . $product->image)` (no `asset('public/storage/...')`)
		4. Los permisos del directorio `storage/app/public` permiten lectura (755)
		5. Verifica que el archivo existe con `ls -la storage/app/public/products/`
		
	* ==**P: Error "419 Page Expired" al enviar formularios despu茅s de instalar Breeze**==
	+ **R:** Verifica los siguientes pasos:
		
		1. Todos los formularios tienen la directiva `@csrf` dentro de la etiqueta `<form>`
		2. Limpia la cach茅 con `sail artisan config:clear` y `sail artisan cache:clear`
		3. Borra las cookies del navegador para `localhost`
		4. Verifica que `.env` tiene `APP_KEY` generada (ejecuta `sail artisan key:generate` si no)
		5. Recarga la p谩gina con Ctrl+F5 (o Cmd+Shift+R en Mac) para limpiar cach茅 del navegador.
 		  
	* ==**P: 驴Por qu茅 tengo dos sintaxis de layouts diferentes (@extends y `<x-app-layout>`)?**==
	+ **R:** Es completamente normal en proyectos que integran Laravel Breeze:
		
		1. Las p谩ginas p煤blicas usan `@extends('layouts.public')` (layout que creaste en pr谩cticas anteriores)
		2. Las p谩ginas de administraci贸n usan `<x-app-layout>` (layout generado autom谩ticamente por Breeze)
		3. Ambas sintaxis son v谩lidas y pueden coexistir en el mismo proyecto
		4. Breeze usa componentes Blade (sintaxis moderna), mientras que tu layout p煤blico usa sintaxis tradicional
		5. En proyectos nuevos, se recomienda elegir una sintaxis, pero en proyectos existentes es normal tener ambas

	* ==**P: Error "Call to undefined method store()" al subir archivos**==
	+ **R:** Verifica los siguientes pasos:

		1. El formulario tiene `enctype="multipart/form-data"` en la etiqueta `<form>`
		2. El campo input es de tipo `file`: `<input type="file" name="image">`
		3. Usas `$request->file('image')` (no `$request->input('image')`)
		4. Validas el archivo con `'image' => 'required|image|mimes:jpeg,png,jpg|max:2048'`
		5. Importaste la facade `use Illuminate\Support\Facades\Storage;` si usas m茅todos de Storage
	* ==**P: Los datos del carrito se pierden al cerrar el navegador**==
	+ **R:** Esto es el comportamiento esperado de las sesiones:
	
		1. Las sesiones por defecto expiran cuando se cierra el navegador
		2. 1. Si quieres persistencia, debes usar la tabla `product_user` (como en la wishlist)
		3. El carrito usa sesiones porque es temporal y debe vaciarse tras la compra
		4. La wishlist usa base de datos porque es permanente y debe persistir entre sesiones
		5. Para extender el tiempo de sesi贸n, modifica `SESSION_LIFETIME` en `.env` (en minutos)
	* ==**P: 驴C贸mo depuro errores en los middleware personalizados?**==
	+ **R:** Usa estas t茅cnicas:
	
		1. A帽ade `Log::info('Mensaje de debug', ['data' => $variable])` en el middleware
		2. Revisa los logs con `tail -f storage/logs/laravel.log`
		3. Usa `dd($request->all())` para ver qu茅 recibe el middleware
		4. Verifica que el middleware est谩 registrado en `bootstrap/app.php`
		5. Comprueba que se aplica a las rutas correctas con `sail artisan route:list`

##  Hitos a conseguir

> Al completar esta sesi贸n, habr谩s creado una **aplicaci贸n web completa y segura con Laravel** que incluya:
>
> * **Sistema de autenticaci贸n completo** con Laravel Breeze (login, registro, logout)
> * **Formularios seguros** con protecci贸n CSRF y validaci贸n robusta en m煤ltiples capas
> * **CRUD completo de productos** con formularios de creaci贸n, edici贸n y eliminaci贸n protegidos
> * **Sistema de almacenamiento de archivos** para gestionar im谩genes de productos de forma segura
> * **Carrito de compras funcional** con gesti贸n de sesiones
> * **Lista de deseos (wishlist)** persistente en base de datos para usuarios autenticados
> * **Middleware personalizado** para logging de actividad de administradores
> * **Mensajes flash** para feedback consistente al usuario
> * **Panel de administraci贸n** protegido con middleware de autenticaci贸n
> * **Separaci贸n de layouts** p煤blicos (sintaxis tradicional) y privados (componentes Blade)
> * **Validaci贸n de archivos** con tipos MIME y tama帽os m谩ximos
> * **Manejo elegante de errores** con mensajes personalizados en espa帽ol
>
> **Resultado:** Una aplicaci贸n de tienda online profesional, segura y completamente funcional que maneja de forma robusta la interacci贸n con el usuario, desde la navegaci贸n p煤blica hasta la gesti贸n administrativa, demostrando el dominio de las t茅cnicas fundamentales de desarrollo web seguro con Laravel.
