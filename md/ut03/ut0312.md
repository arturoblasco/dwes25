---
title: 3.12. M√©todos m√°gicos
---
# 3.12. M√©todos m√°gicos

Todas las clases PHP ofrecen un conjunto de m√©todos, tambi√©n conocidos como *magic methods* que se pueden sobreescribir para sustituir su comportamiento. Algunos de ellos ya los hemos utilizado.

Ante cualquier duda, es conveniente consultar la [documentaci√≥n oficial](https://www.php.net/manual/es/language.oop5.magic.php){:target="_blank"}.

Los m√°s destacables son:

- **`__construct()`**
- **`__destruct()`** ‚Üí se invoca al perder la referencia. Se utiliza para cerrar una conexi√≥n a la BD, cerrar un fichero, ...
- **`__toString()`** ‚Üí representaci√≥n del objeto como cadena. Es decir, cuando hacemos `echo $objeto` se ejecuta autom√°ticamente este m√©todo.
- **`get(atributo)`**, **`set(atributo, valor)`** ‚Üí Permitir√≠a acceder a los atributos privados, aunque siempre es m√°s legible/mantenible codificar los getter/setter.
- **`__isset(atributo)`**, **`__unset(atributo)`** ‚Üí Permite averiguar o quitar el valor a un atributo.
- **`sleep()`**, **`wakeup()`** ‚Üí Se ejecutan al recuperar (*unserialize^*) o almacenar un objeto que se serializa (*serialize*), y se utilizan para permite definir qu√© atributos se serializan.
- **`call()`**, **`callStatic()`** ‚Üí Se ejecutan al llamar a un m√©todo que no es p√∫blico. Permiten sobrecargar m√©todos.

???examplephp "Ejemplo"
    ```php
    <?php
    class EjemploMagico {
        private string $nombre;
        private int $edad;
        private ?string $conexion = null;

        // __construct: se ejecuta al crear el objeto
        public function __construct(string $nombre, int $edad) {
            echo "‚ñ∂ Constructor ejecutado<br>";
            $this->nombre = $nombre;
            $this->edad = $edad;
            $this->conexion = "Conectado a BD";
        }

        // __destruct: se ejecuta al destruir el objeto o perder la referencia
        public function __destruct() {
            echo "‚èπ Destructor ejecutado: cerrando conexi√≥n...<br>";
            $this->conexion = null;
        }

        // __toString: representaci√≥n del objeto como texto (echo $obj)
        public function __toString(): string {
            return "Nombre: {$this->nombre}, Edad: {$this->edad}";
        }

        // Getters y Setters (acceso controlado a atributos privados)
        public function getNombre(): string {
            return $this->nombre;
        }

        public function setNombre(string $nombre): self {
            $this->nombre = $nombre;
            return $this;
        }

        public function getEdad(): int {
            return $this->edad;
        }

        public function setEdad(int $edad): self {
            $this->edad = $edad;
            return $this;
        }

        // __isset y __unset: permiten verificar o eliminar propiedades privadas
        public function __isset($propiedad): bool {
            echo "¬øExiste la propiedad '$propiedad'? ";
            return isset($this->$propiedad);
        }

        public function __unset($propiedad): void {
            echo "Eliminando la propiedad '$propiedad'...<br>";
            unset($this->$propiedad);
        }

        // __sleep y __wakeup: controlan la serializaci√≥n y deserializaci√≥n
        public function __sleep(): array {
            echo "üíæ Serializando objeto...<br>";
            // Solo queremos guardar nombre y edad, no la conexi√≥n
            return ['nombre', 'edad'];
        }

        public function __wakeup(): void {
            echo "üîÑ Objeto restaurado. Reconectando...<br>";
            $this->conexion = "Conectado de nuevo";
        }

        // __call: se ejecuta cuando se invoca un m√©todo inexistente o privado
        public function __call($metodo, $argumentos) {
            echo "‚ö†Ô∏è Intentando llamar a m√©todo no definido '$metodo' con args: ";
            print_r($argumentos);
        }

        // __callStatic: igual que __call pero para m√©todos est√°ticos
        public static function __callStatic($metodo, $argumentos) {
            echo "‚ö†Ô∏è Llamada est√°tica a '$metodo' con args: ";
            print_r($argumentos);
        }
    }

    // DEMOSTRACI√ìN
    $obj = new EjemploMagico("Arturo", 25);
    echo "<hr>";

    // echo ‚Üí ejecuta autom√°ticamente __toString
    echo $obj . "<br><hr>";

    // Getters y setters
    $obj->setNombre("Ana")->setEdad(30);
    echo $obj->getNombre() . " tiene " . $obj->getEdad() . " a√±os.<br><hr>";

    // isset / unset m√°gicos
    var_dump(isset($obj->nombre));  // false
    var_dump(isset($obj->edad));    // true (aunque sea privada)
    unset($obj->edad);
    var_dump(isset($obj->edad));    // false
    echo "<hr>";

    // Serializaci√≥n (sleep / wakeup)
    $serializado = serialize($obj);
    echo "Objeto serializado: $serializado<br>";
    $restaurado = unserialize($serializado);
    echo $restaurado . "<br><hr>";

    // call / callStatic
    $obj->metodoInexistente("dato1", "dato2");
    EjemploMagico::metodoEstaticoInexistente(123, 456);

    echo "<hr>Fin del script<br>";
    ```